#!/bin/bash

# This script is a wrapper for executing the setup_participant script on a remote
# device on the LAN using SSH.
#
# Usage: remote_setup <target_host> [-u]
#   -u: uninstall the tracr user and remove all tracr files
#
# NOTE: see the setup_participant script for a description of the exit codes

# User provides the target host and optional -u flag as command-line arguments
target_host="$1"
uninstall_flag="$2"

# Check if the user has provided the target host
if [[ -z "$target_host" ]]; then
    echo "Usage: $0 target_host [-u]"
    exit 1
fi

# Check if the -u flag is provided
if [[ "$uninstall_flag" == "-u" ]]; then
    script_args="-u"
else
    script_args=""
fi

# Set path to inner script
script_path="$(dirname "$(realpath "$0")")/src/setup_participant"

# Check if the script file exists and is readable
if [[ ! -f "$script_path" ]] || [[ ! -r "$script_path" ]]; then
    echo "Error: script file '$script_path' does not exist or is not readable"
    exit 1
fi

# Use SSH to execute the script on the remote host
ssh -t "$target_host" "bash -s" -- < $script_path "$script_args"
